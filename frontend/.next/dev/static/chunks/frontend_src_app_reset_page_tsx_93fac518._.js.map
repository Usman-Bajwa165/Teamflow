{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["C:/Users/Window/Desktop/Teamflow/frontend/src/app/reset/page.tsx"],"sourcesContent":["'use client';\r\nimport React, { useEffect, useState } from 'react';\r\nimport { useSearchParams, useRouter } from 'next/navigation';\r\nimport { resetPassword, validateResetToken } from '../../lib/api';\r\n\r\nexport default function ResetPage() {\r\n  const searchParams = useSearchParams();\r\n  const router = useRouter();\r\n  const token = searchParams?.get('token') ?? '';\r\n\r\n  const [password, setPassword] = useState('');\r\n  const [err, setErr] = useState<string | null>(null);\r\n  const [msg, setMsg] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  // validation state\r\n  const [validating, setValidating] = useState(true);\r\n  const [valid, setValid] = useState<boolean | null>(null);\r\n  const [invalidReason, setInvalidReason] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    // if no token present, mark invalid immediately\r\n    if (!token) {\r\n      setValid(false);\r\n      setInvalidReason('missing');\r\n      setValidating(false);\r\n      return;\r\n    }\r\n\r\n    let mounted = true;\r\n    setValidating(true);\r\n    (async () => {\r\n      try {\r\n        const res = await validateResetToken(token);\r\n        if (!mounted) return;\r\n        if (res && res.valid) {\r\n          setValid(true);\r\n          setInvalidReason(null);\r\n        } else {\r\n          setValid(false);\r\n          setInvalidReason(res?.reason || 'invalid');\r\n        }\r\n      } catch (e: any) {\r\n        setValid(false);\r\n        // fallback message\r\n        setInvalidReason(e?.body?.message || 'invalid');\r\n      } finally {\r\n        setValidating(false);\r\n      }\r\n    })();\r\n\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, [token]);\r\n\r\n  async function submit(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    setErr(null);\r\n    setMsg(null);\r\n\r\n    if (!valid) {\r\n      setErr('Reset link is invalid or expired. Request a new reset.');\r\n      return;\r\n    }\r\n\r\n    if (password.length < 7) {\r\n      setErr('Password must be at least 7 characters.');\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      await resetPassword(token, password);\r\n      setMsg('Password reset successful. Redirecting to login...');\r\n      setTimeout(() => router.push('/login'), 1200);\r\n    } catch (error: any) {\r\n      // surface backend message\r\n      let message = 'Reset failed';\r\n      if (error?.body) {\r\n        try {\r\n          const body = typeof error.body === 'string' ? JSON.parse(error.body) : error.body;\r\n          message = body?.message || JSON.stringify(body);\r\n        } catch {\r\n          message = String(error?.body);\r\n        }\r\n      } else if (error?.message) {\r\n        message = error.message;\r\n      }\r\n      setErr(message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  // map reason to user friendly message\r\n  function reasonToMessage(r: string | null) {\r\n    switch (r) {\r\n      case 'used':\r\n        return 'This reset link was already used. Request a new reset.';\r\n      case 'expired':\r\n        return 'This reset link has expired. Request a new reset.';\r\n      case 'missing':\r\n        return 'Missing or invalid reset link. Request a new reset.';\r\n      case 'invalid':\r\n      default:\r\n        return 'Invalid reset link. Request a new reset.';\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-md mx-auto mt-12 p-6 bg-white rounded-lg shadow\">\r\n      <h2 className=\"text-2xl font-semibold mb-4 text-slate-800\">Reset password</h2>\r\n\r\n      {validating ? (\r\n        <div className=\"mb-4 text-slate-600\">Validating link...</div>\r\n      ) : null}\r\n\r\n      {err && <div className=\"mb-3 text-red-600\">{err}</div>}\r\n      {msg && <div className=\"mb-3 text-green-600\">{msg}</div>}\r\n\r\n      {/* Modal/popup when invalid */}\r\n      {valid === false && !validating ? (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center px-4\">\r\n          <div className=\"absolute inset-0 bg-black/40\" />\r\n          <div className=\"relative z-10 max-w-lg w-full bg-white rounded-lg shadow-lg p-6\">\r\n            <h3 className=\"text-lg font-semibold mb-2\">Reset link not usable</h3>\r\n            <p className=\"mb-4 text-sm text-slate-600\">{reasonToMessage(invalidReason)}</p>\r\n            <div className=\"flex gap-2 justify-end\">\r\n              <button\r\n                onClick={() => router.push('/forgot')}\r\n                className=\"px-4 py-2 bg-indigo-600 text-white rounded\"\r\n              >\r\n                Request new reset\r\n              </button>\r\n              <button\r\n                onClick={() => router.push('/')}\r\n                className=\"px-4 py-2 border rounded\"\r\n              >\r\n                Back to home\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n\r\n      {/* form (disabled if link invalid) */}\r\n      <form onSubmit={submit} className=\"space-y-4 opacity-100\" aria-hidden={valid === false}>\r\n        <div>\r\n          <label className=\"block text-sm text-slate-600 mb-1\">New password</label>\r\n          <input\r\n            type=\"password\"\r\n            value={password}\r\n            onChange={(e) => setPassword(e.target.value)}\r\n            placeholder=\"Enter a new password (min 7 chars)\"\r\n            className=\"w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-indigo-300\"\r\n            disabled={!valid || validating}\r\n          />\r\n        </div>\r\n\r\n        <div className=\"flex items-center justify-between\">\r\n          <button\r\n            type=\"submit\"\r\n            disabled={!valid || validating || loading}\r\n            className=\"bg-indigo-600 text-white px-4 py-2 rounded disabled:opacity-60\"\r\n          >\r\n            {loading ? 'Resetting...' : 'Reset password'}\r\n          </button>\r\n\r\n          <a className=\"text-sm text-indigo-600 hover:underline\" href=\"/login\">\r\n            Back to login\r\n          </a>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["React","useEffect","useState","useSearchParams","useRouter","resetPassword","validateResetToken","ResetPage","searchParams","router","token","get","password","setPassword","err","setErr","msg","setMsg","loading","setLoading","validating","setValidating","valid","setValid","invalidReason","setInvalidReason","mounted","res","reason","e","body","message","submit","FormEvent","preventDefault","length","setTimeout","push","error","JSON","parse","stringify","String","reasonToMessage","r","target","value"],"mappings":"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","ignoreList":[],"debugId":null}}]
}