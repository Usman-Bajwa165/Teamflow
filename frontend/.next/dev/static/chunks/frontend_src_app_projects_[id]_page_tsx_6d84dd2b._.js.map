{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["C:/Users/Window/Desktop/Teamflow/frontend/src/app/projects/[id]/page.tsx"],"sourcesContent":["// frontend/src/app/projects/[id]/page.tsx\r\n\"use client\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useParams } from \"next/navigation\";\r\nimport {\r\n  getProject,\r\n  createColumn,\r\n  createTask,\r\n  moveTask,\r\n  updateTask,\r\n  deleteTask,\r\n  getTeamMembers,\r\n} from \"../../../lib/api\";\r\nimport TaskBoard, { Column } from \"../../../src/components/TaskBoard\";\r\nimport TaskModal from \"../../../src/components/TaskModal\";\r\n\r\nexport default function ProjectBoard() {\r\n  const params = useParams();\r\n  const projectId = params.id;\r\n  const [project, setProject] = useState<any>(null);\r\n  const [teamMembers, setTeamMembers] = useState<any[] | null>(null);\r\n  const [msg, setMsg] = useState<string | null>(null);\r\n  const [newColTitle, setNewColTitle] = useState(\"\");\r\n\r\n  // modal state\r\n  const [openTask, setOpenTask] = useState<any | null>(null);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      if (!projectId) return;\r\n      try {\r\n        const p = await getProject(projectId);\r\n        const normalized = {\r\n          ...p,\r\n          columns: (p?.columns || []).map((c: any) => ({\r\n            ...c,\r\n            tasks: c?.tasks || [],\r\n          })),\r\n        };\r\n        setProject(normalized);\r\n\r\n        // if project has teamId, fetch team members\r\n        if (normalized.teamId) {\r\n          try {\r\n            const members = await getTeamMembers(normalized.teamId);\r\n            setTeamMembers(members || []);\r\n          } catch (err) {\r\n            // ignore gracefully; teamMembers stays null\r\n            setTeamMembers([]);\r\n          }\r\n        } else {\r\n          setTeamMembers(null);\r\n        }\r\n      } catch (err) {\r\n        setMsg(\"Failed to load project\");\r\n      }\r\n    })();\r\n  }, [projectId]);\r\n\r\n  async function addColumn(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    setMsg(null);\r\n    const title = (newColTitle || \"\").trim();\r\n    if (!title) {\r\n      setMsg(\"Column title required\");\r\n      return;\r\n    }\r\n    try {\r\n      const col = await createColumn(project.id, title);\r\n      const newCol = { ...col, tasks: col?.tasks || [] };\r\n      setProject((prev) => ({\r\n        ...(prev || {}),\r\n        columns: (prev?.columns || []).concat(newCol),\r\n      }));\r\n      setNewColTitle(\"\");\r\n    } catch (err: any) {\r\n      setMsg(err?.body?.message || \"Failed to create column\");\r\n    }\r\n  }\r\n\r\n  function handleColumnsChange(cols: Column[]) {\r\n    setProject((prev) => ({ ...(prev || {}), columns: cols }));\r\n  }\r\n\r\n  async function handleMove(\r\n    taskId: string,\r\n    targetColumnId: string,\r\n    targetPosition: number\r\n  ) {\r\n    await moveTask(taskId, targetColumnId, targetPosition);\r\n  }\r\n\r\n  async function handleAddTask(columnId: string, title: string) {\r\n    setMsg(null);\r\n    try {\r\n      const t = await createTask(columnId, title);\r\n      setProject((prev) => ({\r\n        ...(prev || {}),\r\n        columns: (prev?.columns || []).map((c: any) =>\r\n          c.id === columnId ? { ...c, tasks: [...(c.tasks || []), t] } : c\r\n        ),\r\n      }));\r\n    } catch (err: any) {\r\n      setMsg(err?.body?.message || \"Failed to create task\");\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  // open modal\r\n  function handleOpenTask(taskId: string) {\r\n    if (!project) return;\r\n    for (const col of project.columns || []) {\r\n      const t = (col.tasks || []).find((x: any) => x.id === taskId);\r\n      if (t) {\r\n        setOpenTask({ ...t, columnId: col.id });\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  // modal save handler\r\n  async function handleSaveTask(updates: {\r\n    title?: string;\r\n    description?: string;\r\n    assigneeId?: string | null;\r\n  }) {\r\n    if (!openTask) throw new Error(\"no task open\");\r\n    const taskId = openTask.id;\r\n    const updated = await updateTask(taskId, updates);\r\n    setProject((prev) => {\r\n      const cols = (prev?.columns || []).map((c: any) => ({\r\n        ...c,\r\n        tasks: (c.tasks || []).map((t: any) =>\r\n          t.id === taskId ? { ...t, ...updated } : t\r\n        ),\r\n      }));\r\n      return { ...(prev || {}), columns: cols };\r\n    });\r\n    // after change, re-calc assigned list â€” optional: we fetch members again if needed\r\n    return updated;\r\n  }\r\n\r\n  // modal delete handler\r\n  async function handleDeleteTask() {\r\n    if (!openTask) throw new Error(\"no task open\");\r\n    const taskId = openTask.id;\r\n    await deleteTask(taskId);\r\n    setProject((prev) => {\r\n      const cols = (prev?.columns || []).map((c: any) => ({\r\n        ...c,\r\n        tasks: (c.tasks || []).filter((t: any) => t.id !== taskId),\r\n      }));\r\n      return { ...(prev || {}), columns: cols };\r\n    });\r\n  }\r\n\r\n  // compute assigned user ids for this project\r\n  function computeAssignedUserIds() {\r\n    if (!project) return [];\r\n    const ids: string[] = [];\r\n    for (const c of project.columns || []) {\r\n      for (const t of c.tasks || []) {\r\n        if (t.assigneeId) ids.push(t.assigneeId);\r\n      }\r\n    }\r\n    return [...new Set(ids)];\r\n  }\r\n\r\n  if (!project) return <div>Loading project...</div>;\r\n\r\n  return (\r\n    <div>\r\n      <h2 className=\"text-2xl font-bold mb-4\">{project.name}</h2>\r\n      {msg && <div className=\"mb-3 text-red-600\">{msg}</div>}\r\n\r\n      <div className=\"mb-4\">\r\n        <form onSubmit={addColumn} className=\"flex gap-2\">\r\n          <input\r\n            value={newColTitle}\r\n            onChange={(e) => setNewColTitle(e.target.value)}\r\n            placeholder=\"New column title\"\r\n            className=\"px-3 py-2 border rounded flex-1\"\r\n          />\r\n          <button className=\"bg-slate-600 text-white px-3 py-2 rounded\">\r\n            Add column\r\n          </button>\r\n        </form>\r\n      </div>\r\n\r\n      <TaskBoard\r\n        columns={project.columns as Column[]}\r\n        onMove={handleMove}\r\n        onColumnsChange={handleColumnsChange}\r\n        onAddTask={handleAddTask}\r\n        onOpenTask={handleOpenTask}\r\n      />\r\n\r\n      <TaskModal\r\n        task={openTask}\r\n        projectId={project.id}\r\n        teamMembers={teamMembers ?? []}\r\n        assignedUserIds={computeAssignedUserIds()}\r\n        onClose={() => setOpenTask(null)}\r\n        onSave={handleSaveTask}\r\n        onDelete={handleDeleteTask}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":["React","useEffect","useState","useParams","getProject","createColumn","createTask","moveTask","updateTask","deleteTask","getTeamMembers","TaskBoard","Column","TaskModal","ProjectBoard","params","projectId","id","project","setProject","teamMembers","setTeamMembers","msg","setMsg","newColTitle","setNewColTitle","openTask","setOpenTask","p","normalized","columns","map","c","tasks","teamId","members","err","addColumn","e","FormEvent","preventDefault","title","trim","col","newCol","prev","concat","body","message","handleColumnsChange","cols","handleMove","taskId","targetColumnId","targetPosition","handleAddTask","columnId","t","handleOpenTask","find","x","handleSaveTask","updates","description","assigneeId","Error","updated","handleDeleteTask","filter","computeAssignedUserIds","ids","push","Set","name","target","value"],"mappings":"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","ignoreList":[],"debugId":null}}]
}