{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["C:/Users/Window/Desktop/Teamflow/frontend/src/app/projects/page.tsx"],"sourcesContent":["\"use client\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport {\r\n  createProject,\r\n  listProjects,\r\n  getMyTeams,\r\n  getAllTeams,\r\n  updateProject,\r\n  deleteProject,\r\n} from \"../../lib/api\";\r\nimport Link from \"next/link\";\r\nimport { useAuth } from \"../../context/AuthContext\";\r\n\r\nexport default function ProjectsListPage() {\r\n  const { user } = useAuth();\r\n  const isAdmin = user?.role === \"admin\";\r\n\r\n  const [projects, setProjects] = useState<any[]>([]);\r\n  const [name, setName] = useState(\"\");\r\n  const [desc, setDesc] = useState(\"\");\r\n  const [selectedTeamId, setSelectedTeamId] = useState(\"\");\r\n  const [teams, setTeams] = useState<any[]>([]);\r\n  const [dueDate, setDueDate] = useState(\"\");\r\n  const [msg, setMsg] = useState<string | null>(null);\r\n  const [myTeams, setMyTeams] = useState<any[]>([]); // user's memberships\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const res = await listProjects();\r\n        setProjects(res || []);\r\n      } catch (err) {\r\n        // ignore\r\n      }\r\n\r\n      try {\r\n        if (isAdmin) {\r\n          const all = await getAllTeams();\r\n          setTeams(all || []);\r\n        } else {\r\n          const my = await getMyTeams();\r\n          setTeams(my || []);\r\n          setMyTeams(my || []);\r\n          if ((my || []).length > 0) setSelectedTeamId(my[0]?.team?.id || \"\");\r\n        }\r\n      } catch (err) {\r\n        setTeams([]);\r\n      }\r\n    })();\r\n  }, [isAdmin]);\r\n\r\n  // helper: determine if current user can edit this project\r\n  function canEditProject(p: any) {\r\n    if (isAdmin) return true;\r\n    if (!p?.team?.id) return false;\r\n    // myTeams contains items shaped like { team: {...}, role: 'owner'|'admin'|'member' }\r\n    return (myTeams || []).some(\r\n      (m) =>\r\n        (m.team?.id ?? m.id) === p.team.id &&\r\n        [\"owner\", \"admin\"].includes(m.role)\r\n    );\r\n  }\r\n\r\n  async function addProject(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    setMsg(null);\r\n    if (!name || name.trim().length < 2) {\r\n      setMsg(\"Project name must be at least 2 characters.\");\r\n      return;\r\n    }\r\n    if (!selectedTeamId) {\r\n      setMsg(\"Please choose a team for this project.\");\r\n      return;\r\n    }\r\n    try {\r\n      const p = await createProject(\r\n        name.trim(),\r\n        desc.trim(),\r\n        selectedTeamId,\r\n        dueDate || undefined\r\n      );\r\n      setProjects((s) => [...s, p]);\r\n      setName(\"\");\r\n      setDesc(\"\");\r\n      setDueDate(\"\");\r\n    } catch (err: any) {\r\n      const errMsg = err?.body?.message || \"Failed to create project\";\r\n      setMsg(errMsg);\r\n    }\r\n  }\r\n\r\n  async function onDeleteProject(projectId: string) {\r\n    if (!confirm(\"Type project name to confirm deletion:\")) return;\r\n    try {\r\n      await deleteProject(projectId);\r\n      setProjects((s) => s.filter((x) => x.id !== projectId));\r\n    } catch (err: any) {\r\n      alert(err?.body?.message || \"Delete failed\");\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <h2 className=\"text-2xl mb-4\">Projects</h2>\r\n\r\n      {isAdmin && (\r\n        <form onSubmit={addProject} className=\"mb-6 space-y-2\">\r\n          <input\r\n            value={name}\r\n            onChange={(e) => setName(e.target.value)}\r\n            placeholder=\"Project name\"\r\n            className=\"w-full px-3 py-2 border rounded\"\r\n          />\r\n          <input\r\n            value={desc}\r\n            onChange={(e) => setDesc(e.target.value)}\r\n            placeholder=\"Description (optional)\"\r\n            className=\"w-full px-3 py-2 border rounded\"\r\n          />\r\n\r\n          <div>\r\n            <label className=\"text-sm block mb-1\">\r\n              Assign to team (required)\r\n            </label>\r\n            <select\r\n              value={selectedTeamId}\r\n              onChange={(e) => setSelectedTeamId(e.target.value)}\r\n              className=\"w-full px-3 py-2 border rounded\"\r\n            >\r\n              <option value=\"\">-- select team --</option>\r\n              {teams.map((t) => (\r\n                <option\r\n                  key={t.team?.id ?? t.id}\r\n                  value={t.team?.id ?? t.id}\r\n                  style={{\r\n                    backgroundColor: t.projectCount > 0 ? \"#ffeef0\" : undefined,\r\n                  }}\r\n                >\r\n                  {t.team?.name ?? t.name}{\" \"}\r\n                  {t.projectCount > 0 ? \"(has projects)\" : \"\"}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"text-sm block mb-1\">Due date (optional)</label>\r\n            <input\r\n              type=\"date\"\r\n              value={dueDate}\r\n              onChange={(e) => setDueDate(e.target.value)}\r\n              className=\"w-full px-3 py-2 border rounded\"\r\n            />\r\n          </div>\r\n\r\n          <button className=\"bg-indigo-600 text-white px-4 py-2 rounded\">\r\n            Create project\r\n          </button>\r\n        </form>\r\n      )}\r\n\r\n      <ul className=\"space-y-3\">\r\n        {projects.map((p) => (\r\n          <li\r\n            key={p.id}\r\n            className=\"border p-3 rounded flex justify-between items-center\"\r\n          >\r\n            <div>\r\n              <div className=\"font-semibold\">{p.name}</div>\r\n              <div className=\"text-sm text-gray-600\">{p.description}</div>\r\n              {p.team && (\r\n                <div className=\"text-sm text-gray-500\">Team: {p.team.name}</div>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"flex gap-2\">\r\n              <Link href={`/projects/${p.id}`} className=\"text-blue-600\">\r\n                Open board\r\n              </Link>\r\n\r\n              {canEditProject(p) && (\r\n                <Link\r\n                  href={`/projects/${p.id}/edit`}\r\n                  className=\"text-sm px-2 py-1 border rounded\"\r\n                >\r\n                  Edit\r\n                </Link>\r\n              )}\r\n\r\n              {canEditProject(p) && (\r\n                <button\r\n                  onClick={() => onDeleteProject(p.id)}\r\n                  className=\"text-sm px-2 py-1 border rounded bg-red-50\"\r\n                >\r\n                  Delete\r\n                </button>\r\n              )}\r\n            </div>\r\n          </li>\r\n        ))}\r\n      </ul>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["React","useEffect","useState","createProject","listProjects","getMyTeams","getAllTeams","updateProject","deleteProject","Link","useAuth","ProjectsListPage","user","isAdmin","role","projects","setProjects","name","setName","desc","setDesc","selectedTeamId","setSelectedTeamId","teams","setTeams","dueDate","setDueDate","msg","setMsg","myTeams","setMyTeams","res","err","all","my","length","team","id","canEditProject","p","some","m","includes","addProject","e","FormEvent","preventDefault","trim","undefined","s","errMsg","body","message","onDeleteProject","projectId","confirm","filter","x","alert","target","value","map","t","backgroundColor","projectCount","description"],"mappings":"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","ignoreList":[],"debugId":null}}]
}