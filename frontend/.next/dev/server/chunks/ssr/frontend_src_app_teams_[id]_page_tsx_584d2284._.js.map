{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Window/Desktop/Teamflow/frontend/src/app/teams/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\";\r\n// frontend/src/app/teams/[id]/page.tsx\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useParams, useRouter } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\nimport { useAuth } from \"../../../context/AuthContext\";\r\nimport { getTeamDetails as apiGetTeamDetails } from \"../../../lib/api\";\r\n\r\ntype UserBase = {\r\n  id: string;\r\n  email: string;\r\n  name?: string | null;\r\n  // optional helpers some admin endpoints return:\r\n  _count?: { teamMembers?: number };\r\n  teamIds?: string[]; // if backend provides array of team ids\r\n};\r\ntype TeamMember = {\r\n  id: string;\r\n  role: \"owner\" | \"admin\" | \"member\" | string;\r\n  user: UserBase;\r\n};\r\ntype Team = {\r\n  id: string;\r\n  name: string;\r\n  ownerId?: string | null;\r\n  members?: TeamMember[];\r\n  projects?: { id: string; name?: string; description?: string }[];\r\n};\r\n\r\nconst API_BASE = process.env.NEXT_PUBLIC_API_BASE ?? \"http://localhost:4000\";\r\n\r\nexport default function TeamPage() {\r\n  const params = useParams();\r\n  const router = useRouter();\r\n  const teamId = Array.isArray(params?.id) ? params.id[0] : params?.id;\r\n  const { user } = useAuth();\r\n\r\n  // local state\r\n  const [team, setTeam] = useState<Team | null>(null);\r\n  const [loading, setLoading] = useState<boolean>(false);\r\n  const [msg, setMsg] = useState<string | null>(null);\r\n\r\n  // invite state\r\n  const [inviteEmail, setInviteEmail] = useState<string>(\"\");\r\n  const [inviteRole, setInviteRole] = useState<\"member\" | \"admin\" | \"owner\">(\r\n    \"member\"\r\n  );\r\n  const [usersList, setUsersList] = useState<UserBase[] | null>(null);\r\n  const [selectedUserId, setSelectedUserId] = useState<string | null>(null);\r\n\r\n  const [processingMemberId, setProcessingMemberId] = useState<string | null>(\r\n    null\r\n  );\r\n\r\n  // delete-confirm UI state\r\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\r\n  const [deleteNameInput, setDeleteNameInput] = useState(\"\");\r\n  const [deleting, setDeleting] = useState(false);\r\n\r\n  if (!teamId) return <div>Invalid team id</div>;\r\n\r\n  function authHeaders() {\r\n    const t =\r\n      typeof window !== \"undefined\" ? localStorage.getItem(\"tf_access\") : null;\r\n    return {\r\n      \"Content-Type\": \"application/json\",\r\n      ...(t ? { Authorization: `Bearer ${t}` } : {}),\r\n    };\r\n  }\r\n\r\n  // 1) load team (always)\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    (async () => {\r\n      setMsg(null);\r\n      setLoading(true);\r\n      try {\r\n        const data = await apiGetTeamDetails(String(teamId));\r\n        if (!mounted) return;\r\n        setTeam(data as Team);\r\n      } catch (err: unknown) {\r\n        const e = err as { status?: number; body?: any } | Error;\r\n        setMsg(\r\n          (e as any)?.body?.message ||\r\n            (e as Error).message ||\r\n            \"Failed to load team\"\r\n        );\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    })();\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, [teamId]);\r\n\r\n  // 2) load users list ONLY if the signed-in user is a global admin.\r\n  // This avoids hitting /admin/users (404) for non-admin users.\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    (async () => {\r\n      setUsersList(null);\r\n      if (!user?.role || user.role !== \"admin\") return;\r\n      try {\r\n        const res = await fetch(`${API_BASE}/admin/users`, {\r\n          headers: authHeaders(),\r\n        });\r\n        if (!mounted) return;\r\n        if (!res.ok) {\r\n          // don't print to console — fail silently (admins can still manually invite)\r\n          setUsersList(null);\r\n          return;\r\n        }\r\n        const json = await res.json();\r\n        // Expecting an array; if server returns wrapper, try to extract.\r\n        let arr: UserBase[] = [];\r\n        if (Array.isArray(json)) arr = json as UserBase[];\r\n        else if (Array.isArray(json.users)) arr = json.users;\r\n        else if (Array.isArray(json.data)) arr = json.data;\r\n        else arr = json as UserBase[]; // best-effort\r\n        if (mounted) setUsersList(arr);\r\n      } catch {\r\n        if (mounted) setUsersList(null);\r\n      }\r\n    })();\r\n    return () => {\r\n      mounted = false;\r\n    };\r\n  }, [user?.role]);\r\n\r\n  const myUserId = user?.id ?? null;\r\n  const myMembership = team?.members?.find((m) => m.user?.id === myUserId);\r\n  const myRoleInTeam = myMembership?.role ?? null;\r\n  const canManage =\r\n    user?.role === \"admin\" ||\r\n    myRoleInTeam === \"owner\" ||\r\n    myRoleInTeam === \"admin\";\r\n\r\n  const ownerName =\r\n    team?.members?.find((m) => m.role === \"owner\")?.user?.name ??\r\n    team?.members?.find((m) => m.role === \"owner\")?.user?.email ??\r\n    team?.ownerId ??\r\n    \"—\";\r\n\r\n  async function reloadTeam() {\r\n    setMsg(null);\r\n    setLoading(true);\r\n    try {\r\n      const data = await apiGetTeamDetails(String(teamId));\r\n      setTeam(data as Team);\r\n    } catch (err: unknown) {\r\n      const e = err as { status?: number; body?: any } | Error;\r\n      setMsg(\r\n        (e as any)?.body?.message ||\r\n          (e as Error).message ||\r\n          \"Failed to reload team\"\r\n      );\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function handleInvite(e?: React.FormEvent) {\r\n    e?.preventDefault();\r\n    setMsg(null);\r\n    if (!canManage) {\r\n      setMsg(\"Not permitted\");\r\n      return;\r\n    }\r\n    setProcessingMemberId(\"invite\");\r\n    try {\r\n      let body: { email: string; role: string };\r\n      if (selectedUserId && usersList) {\r\n        const u = usersList.find((x) => x.id === selectedUserId);\r\n        if (!u) throw new Error(\"Selected user not found\");\r\n        body = { email: u.email, role: inviteRole };\r\n      } else {\r\n        if (!inviteEmail) {\r\n          setMsg(\"Enter email or select a user\");\r\n          setProcessingMemberId(null);\r\n          return;\r\n        }\r\n        body = { email: inviteEmail, role: inviteRole };\r\n      }\r\n\r\n      const r = await fetch(`${API_BASE}/teams/${teamId}/invite`, {\r\n        method: \"POST\",\r\n        headers: authHeaders(),\r\n        body: JSON.stringify(body),\r\n      });\r\n      if (!r.ok) {\r\n        const txt = await r.text().catch(() => \"\");\r\n        const parsed = (() => {\r\n          try {\r\n            return JSON.parse(txt);\r\n          } catch {\r\n            return null;\r\n          }\r\n        })();\r\n        const message =\r\n          parsed?.message ||\r\n          parsed?.error ||\r\n          txt ||\r\n          `Invite failed (${r.status})`;\r\n        setMsg(message);\r\n        setProcessingMemberId(null);\r\n        return;\r\n      }\r\n\r\n      setInviteEmail(\"\");\r\n      setSelectedUserId(null);\r\n      setInviteRole(\"member\");\r\n      await reloadTeam();\r\n      setMsg(\"Invitation/added successfully.\");\r\n    } catch (err: unknown) {\r\n      setMsg((err as Error).message || \"Network error\");\r\n    } finally {\r\n      setProcessingMemberId(null);\r\n    }\r\n  }\r\n\r\n  async function changeMemberRole(memberId: string, newRole: string) {\r\n    if (!canManage) {\r\n      setMsg(\"Not permitted\");\r\n      return;\r\n    }\r\n    setProcessingMemberId(memberId);\r\n    try {\r\n      const r = await fetch(\r\n        `${API_BASE}/teams/${teamId}/members/${memberId}/role`,\r\n        {\r\n          method: \"PATCH\",\r\n          headers: authHeaders(),\r\n          body: JSON.stringify({ role: newRole }),\r\n        }\r\n      );\r\n      if (!r.ok) {\r\n        const txt = await r.text().catch(() => \"\");\r\n        throw new Error(txt || `Failed (${r.status})`);\r\n      }\r\n      await reloadTeam();\r\n      setMsg(\"Role updated.\");\r\n    } catch (err: unknown) {\r\n      setMsg((err as Error).message || \"Failed to update role\");\r\n    } finally {\r\n      setProcessingMemberId(null);\r\n    }\r\n  }\r\n\r\n  async function demoteMember(member: TeamMember) {\r\n    const mapping: Record<string, string | null> = {\r\n      owner: \"admin\",\r\n      admin: \"member\",\r\n      member: null,\r\n    };\r\n    const next = mapping[member.role] ?? \"member\";\r\n    if (!next) {\r\n      setMsg(\"Cannot demote further\");\r\n      return;\r\n    }\r\n    await changeMemberRole(member.id, next);\r\n  }\r\n\r\n  async function removeMember(memberId: string) {\r\n    if (!canManage) {\r\n      setMsg(\"Not permitted\");\r\n      return;\r\n    }\r\n    if (!confirm(\"Remove this member from the team?\")) return;\r\n    setProcessingMemberId(memberId);\r\n    try {\r\n      const r = await fetch(`${API_BASE}/teams/${teamId}/members/${memberId}`, {\r\n        method: \"DELETE\",\r\n        headers: authHeaders(),\r\n      });\r\n      if (!r.ok) {\r\n        const txt = await r.text().catch(() => \"\");\r\n        throw new Error(txt || `Failed (${r.status})`);\r\n      }\r\n      await reloadTeam();\r\n      setMsg(\"Member removed.\");\r\n    } catch (err: unknown) {\r\n      setMsg((err as Error).message || \"Failed to remove\");\r\n    } finally {\r\n      setProcessingMemberId(null);\r\n    }\r\n  }\r\n\r\n  function openDeleteForm() {\r\n    setDeleteNameInput(\"\");\r\n    setShowDeleteConfirm(true);\r\n    setMsg(null);\r\n  }\r\n\r\n  async function performDeleteTeam() {\r\n    if (!team) return;\r\n    if (deleteNameInput !== team.name) {\r\n      setMsg(\"Typed name does not match exactly.\");\r\n      return;\r\n    }\r\n    setDeleting(true);\r\n    try {\r\n      const r = await fetch(`${API_BASE}/teams/${teamId}`, {\r\n        method: \"DELETE\",\r\n        headers: authHeaders(),\r\n      });\r\n      if (!r.ok) {\r\n        const txt = await r.text().catch(() => \"\");\r\n        throw new Error(txt || `Delete failed (${r.status})`);\r\n      }\r\n      router.push(\"/teams\");\r\n    } catch (err: unknown) {\r\n      setMsg((err as Error).message || \"Failed to delete team\");\r\n    } finally {\r\n      setDeleting(false);\r\n      setShowDeleteConfirm(false);\r\n    }\r\n  }\r\n\r\n  function userIsInOtherTeam(u: UserBase) {\r\n    // best-effort detection: when backend returned _count or teamIds\r\n    const count =\r\n      typeof u._count?.teamMembers === \"number\"\r\n        ? u._count!.teamMembers\r\n        : undefined;\r\n    const teamIds = Array.isArray((u as any).teamIds)\r\n      ? ((u as any).teamIds as string[])\r\n      : undefined;\r\n    const alreadyInThis = team?.members?.some((m) => m.user?.id === u.id);\r\n    if (typeof count === \"number\") {\r\n      return count > 0 && !alreadyInThis;\r\n    }\r\n    if (Array.isArray(teamIds)) {\r\n      return teamIds.length > 0 && !alreadyInThis;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <div className=\"mb-4\">\r\n        <Link href=\"/teams\" className=\"text-sm text-blue-600\">\r\n          ← Back to teams\r\n        </Link>\r\n      </div>\r\n\r\n      {loading && <div>Loading team...</div>}\r\n      {msg && <div className=\"mb-3 text-red-600\">{msg}</div>}\r\n\r\n      {!loading && team && (\r\n        <>\r\n          <div className=\"mb-4\">\r\n            <h2 className=\"text-2xl font-bold mb-1\">{team.name}</h2>\r\n            <div>\r\n              <strong>Owner:</strong> {ownerName}\r\n            </div>\r\n            <div>\r\n              <strong>Members:</strong> {team.members?.length ?? 0}\r\n            </div>\r\n          </div>\r\n\r\n          {canManage && (\r\n            <div className=\"mb-4 p-3 border rounded\">\r\n              <h3 className=\"font-semibold mb-2\">Add / invite member</h3>\r\n\r\n              {usersList ? (\r\n                <div className=\"flex gap-2 flex-wrap items-center\">\r\n                  <select\r\n                    value={selectedUserId ?? \"\"}\r\n                    onChange={(e) => setSelectedUserId(e.target.value || null)}\r\n                    className=\"px-3 py-2 border rounded\"\r\n                    style={{ minWidth: 300 }}\r\n                  >\r\n                    <option value=\"\">\r\n                      -- Select a user (or leave blank to enter email) --\r\n                    </option>\r\n                    {usersList\r\n                      .filter((u) => u.id !== myUserId)\r\n                      .map((u) => {\r\n                        const inOther = userIsInOtherTeam(u);\r\n                        const disabled = team.members?.some(\r\n                          (m) => m.user?.id === u.id\r\n                        );\r\n                        return (\r\n                          <option\r\n                            key={u.id}\r\n                            value={u.id}\r\n                            disabled={disabled}\r\n                            style={{\r\n                              backgroundColor: disabled\r\n                                ? \"#f0f0f0\"\r\n                                : inOther\r\n                                ? \"#ffecec\"\r\n                                : undefined,\r\n                              color: inOther ? \"#900\" : undefined,\r\n                            }}\r\n                          >\r\n                            {u.name ? `${u.name} — ${u.email}` : u.email}\r\n                            {disabled\r\n                              ? \" (already in this team)\"\r\n                              : inOther\r\n                              ? \" (in other team)\"\r\n                              : \"\"}\r\n                          </option>\r\n                        );\r\n                      })}\r\n                  </select>\r\n\r\n                  <input\r\n                    value={inviteEmail}\r\n                    onChange={(e) => setInviteEmail(e.target.value)}\r\n                    placeholder=\"Or enter email manually\"\r\n                    className=\"px-3 py-2 border rounded flex-1\"\r\n                  />\r\n\r\n                  <select\r\n                    value={inviteRole}\r\n                    onChange={(e) => setInviteRole(e.target.value as any)}\r\n                    className=\"px-2 py-2 border rounded\"\r\n                  >\r\n                    <option value=\"member\">Member</option>\r\n                    <option value=\"admin\">Admin</option>\r\n                    <option value=\"owner\">Owner</option>\r\n                  </select>\r\n\r\n                  <button\r\n                    className=\"bg-green-600 text-white px-3 py-2 rounded\"\r\n                    onClick={(e) => handleInvite(e)}\r\n                    disabled={\r\n                      !!processingMemberId && processingMemberId !== \"invite\"\r\n                    }\r\n                  >\r\n                    {processingMemberId === \"invite\"\r\n                      ? \"Working…\"\r\n                      : \"Add / Invite\"}\r\n                  </button>\r\n                </div>\r\n              ) : (\r\n                <form\r\n                  onSubmit={handleInvite}\r\n                  className=\"flex gap-2 flex-wrap items-center\"\r\n                >\r\n                  <input\r\n                    value={inviteEmail}\r\n                    onChange={(e) => setInviteEmail(e.target.value)}\r\n                    placeholder=\"Email to invite\"\r\n                    className=\"px-3 py-2 border rounded\"\r\n                  />\r\n                  <select\r\n                    value={inviteRole}\r\n                    onChange={(e) => setInviteRole(e.target.value as any)}\r\n                    className=\"px-2 py-2 border rounded\"\r\n                  >\r\n                    <option value=\"member\">Member</option>\r\n                    <option value=\"admin\">Admin</option>\r\n                    <option value=\"owner\">Owner</option>\r\n                  </select>\r\n                  <button\r\n                    type=\"submit\"\r\n                    className=\"bg-green-600 text-white px-3 py-2 rounded\"\r\n                  >\r\n                    Invite\r\n                  </button>\r\n                </form>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          <h3 className=\"text-lg mb-2\">Members</h3>\r\n          <ul className=\"space-y-2 mb-4\">\r\n            {team.members?.map((m) => (\r\n              <li\r\n                key={m.id}\r\n                className=\"p-3 border rounded flex justify-between items-center\"\r\n              >\r\n                <div>\r\n                  <div className=\"font-semibold\">\r\n                    {m.user?.name ?? m.user?.email}{\" \"}\r\n                    <span className=\"ml-2 text-sm text-gray-600\">\r\n                      ({m.user?.email})\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"text-sm text-gray-600\">Role: {m.role}</div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-2\">\r\n                  {canManage ? (\r\n                    <>\r\n                      <button\r\n                        className=\"px-2 py-1 border rounded text-sm\"\r\n                        onClick={() => {\r\n                          const next =\r\n                            m.role === \"member\"\r\n                              ? \"admin\"\r\n                              : m.role === \"admin\"\r\n                              ? \"owner\"\r\n                              : null;\r\n                          if (!next) return;\r\n                          changeMemberRole(m.id, next);\r\n                        }}\r\n                        disabled={!!processingMemberId}\r\n                      >\r\n                        {processingMemberId === m.id\r\n                          ? \"Working…\"\r\n                          : m.role === \"member\"\r\n                          ? \"Promote\"\r\n                          : m.role === \"admin\"\r\n                          ? \"Make owner\"\r\n                          : \"Promote\"}\r\n                      </button>\r\n\r\n                      {m.role !== \"member\" && (\r\n                        <button\r\n                          className=\"px-2 py-1 border rounded text-sm\"\r\n                          onClick={() => demoteMember(m)}\r\n                          disabled={!!processingMemberId}\r\n                        >\r\n                          {processingMemberId === m.id ? \"Working…\" : \"Demote\"}\r\n                        </button>\r\n                      )}\r\n\r\n                      <button\r\n                        className=\"px-2 py-1 bg-red-600 text-white rounded text-sm\"\r\n                        onClick={() => {\r\n                          if (m.user.id === myUserId) {\r\n                            alert(\"You cannot remove yourself.\");\r\n                            return;\r\n                          }\r\n                          removeMember(m.id);\r\n                        }}\r\n                        disabled={\r\n                          !!processingMemberId || m.user.id === myUserId\r\n                        }\r\n                      >\r\n                        {processingMemberId === m.id ? \"Working…\" : \"Remove\"}\r\n                      </button>\r\n                    </>\r\n                  ) : (\r\n                    <div className=\"text-sm text-gray-500\">View only</div>\r\n                  )}\r\n                </div>\r\n              </li>\r\n            ))}\r\n            {(!team.members || team.members.length === 0) && (\r\n              <div>No members yet</div>\r\n            )}\r\n          </ul>\r\n\r\n          <h3 className=\"text-lg mb-2\">Projects assigned</h3>\r\n          <ul>\r\n            {(team.projects || []).map((p) => (\r\n              <li\r\n                key={p.id}\r\n                className=\"p-2 border rounded mb-2 flex justify-between items-center\"\r\n              >\r\n                <div>\r\n                  <div className=\"font-semibold\">{p.name}</div>\r\n                  <div className=\"text-sm text-gray-600\">{p.description}</div>\r\n                </div>\r\n                <div>\r\n                  <Link href={`/projects/${p.id}`} className=\"text-blue-600\">\r\n                    Open\r\n                  </Link>\r\n                </div>\r\n              </li>\r\n            ))}\r\n            {(team.projects || []).length === 0 && (\r\n              <div>No projects assigned</div>\r\n            )}\r\n          </ul>\r\n\r\n          {(user?.role === \"admin\" || myRoleInTeam === \"owner\") && (\r\n            <div className=\"mt-6\">\r\n              {!showDeleteConfirm ? (\r\n                <button\r\n                  className=\"bg-red-700 text-white px-3 py-2 rounded\"\r\n                  onClick={openDeleteForm}\r\n                  disabled={deleting || processingMemberId === \"delete-team\"}\r\n                >\r\n                  Delete team\r\n                </button>\r\n              ) : (\r\n                <div className=\"p-4 border rounded bg-yellow-50 max-w-xl\">\r\n                  <div className=\"mb-2\">\r\n                    <strong>Type the team name to confirm deletion:</strong>\r\n                  </div>\r\n                  <div className=\"mb-2\">\r\n                    This will permanently delete the team{\" \"}\r\n                    <strong>{team.name}</strong> and{\" \"}\r\n                    <strong>\r\n                      will also delete projects assigned to this team\r\n                    </strong>\r\n                    .\r\n                  </div>\r\n\r\n                  <input\r\n                    value={deleteNameInput}\r\n                    onChange={(e) => setDeleteNameInput(e.target.value)}\r\n                    placeholder=\"Type exact team name\"\r\n                    className=\"px-3 py-2 border rounded w-full mb-3\"\r\n                  />\r\n\r\n                  <div className=\"flex gap-2\">\r\n                    <button\r\n                      className=\"bg-red-700 text-white px-3 py-2 rounded\"\r\n                      onClick={() => performDeleteTeam()}\r\n                      disabled={deleting || deleteNameInput !== team.name}\r\n                    >\r\n                      {deleting ? \"Deleting…\" : \"Delete\"}\r\n                    </button>\r\n                    <button\r\n                      className=\"px-3 py-2 border rounded\"\r\n                      onClick={() => {\r\n                        setShowDeleteConfirm(false);\r\n                        setDeleteNameInput(\"\");\r\n                      }}\r\n                      disabled={deleting}\r\n                    >\r\n                      Cancel\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}