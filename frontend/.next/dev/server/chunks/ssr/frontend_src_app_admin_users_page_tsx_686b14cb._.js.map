{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Window/Desktop/Teamflow/frontend/src/app/admin/users/page.tsx"],"sourcesContent":["\"use client\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport {\r\n  getAllUsers,\r\n  createUserAsAdmin,\r\n  updateUserRole,\r\n  deleteUser,\r\n} from \"../../../lib/api\";\r\nimport { useAuth } from \"../../../context/AuthContext\";\r\n\r\ntype User = {\r\n  id: string;\r\n  email: string;\r\n  name?: string | null;\r\n  role: \"member\" | \"admin\" | \"owner\" | string;\r\n};\r\n\r\nexport default function AdminUsersPage() {\r\n\r\n  \r\n  const { user } = useAuth();\r\n  const currentUserId = user?.id ?? null;\r\n  const isAdmin = user?.role === \"admin\";\r\n\r\n  const [users, setUsers] = useState<User[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [err, setErr] = useState<string | null>(null);\r\n\r\n  // create form\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [name, setName] = useState(\"\");\r\n  const [role, setRole] = useState<\"member\" | \"admin\" | \"owner\">(\"member\");\r\n\r\n  // local processing states\r\n  const [creating, setCreating] = useState(false);\r\n  const [processingId, setProcessingId] = useState<string | null>(null);\r\n\r\n  // hydration guard to avoid server/client mismatch\r\n  const [hydrated, setHydrated] = useState(false);\r\n\r\n  useEffect(() => {\r\n    setHydrated(true);\r\n  }, []);\r\n\r\n  // fetch users only after hydrated AND if admin\r\n  useEffect(() => {\r\n    // always run effect (hook order stable), but early return keeps behavior same\r\n    if (!hydrated || !isAdmin) return;\r\n\r\n    let alive = true;\r\n    (async () => {\r\n      setLoading(true);\r\n      setErr(null);\r\n      try {\r\n        const res = await getAllUsers();\r\n        const list = Array.isArray(res) ? res : [];\r\n        // hide current logged-in user from admin list (as requested)\r\n        const filtered = list.filter(\r\n          (u: any) => String(u.id) !== String(currentUserId)\r\n        );\r\n        if (!alive) return;\r\n        setUsers(filtered);\r\n      } catch (e: any) {\r\n        setErr(\"Failed to load users\");\r\n      } finally {\r\n        if (alive) setLoading(false);\r\n      }\r\n    })();\r\n\r\n    return () => {\r\n      alive = false;\r\n    };\r\n  }, [hydrated, isAdmin, currentUserId]);\r\n\r\n  async function handleCreate(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    setErr(null);\r\n\r\n    if (!email || !email.includes(\"@\")) {\r\n      setErr(\"Please provide a valid email.\");\r\n      return;\r\n    }\r\n    if (!password || password.length < 7) {\r\n      setErr(\"Password must be at least 7 characters.\");\r\n      return;\r\n    }\r\n\r\n    setCreating(true);\r\n    try {\r\n      const created = await createUserAsAdmin({\r\n        email: email.trim(),\r\n        password,\r\n        name: name.trim() || undefined,\r\n        role,\r\n      });\r\n      if (created && String(created.id) !== String(currentUserId)) {\r\n        setUsers((s) => [created, ...s]);\r\n      }\r\n      setEmail(\"\");\r\n      setPassword(\"\");\r\n      setName(\"\");\r\n      setRole(\"member\");\r\n    } catch (e: any) {\r\n      // Surface backend reason if present, otherwise fallback to message\r\n      const reason =\r\n        e?.body?.message ||\r\n        e?.message ||\r\n        (typeof e === \"string\" ? e : JSON.stringify(e));\r\n      // Common backend message normalization\r\n      if (/(email.*already|already.*exists|duplicate)/i.test(String(reason))) {\r\n        setErr(\"Email already exists — choose another email.\");\r\n      } else {\r\n        setErr(String(reason));\r\n      }\r\n    } finally {\r\n      setCreating(false);\r\n    }\r\n  }\r\n\r\n  async function changeRolePromoteDemote(u: User) {\r\n    if (!u) return;\r\n    // single promote/demote button behaviour\r\n    const target =\r\n      u.role === \"member\" ? \"admin\" : u.role === \"admin\" ? \"member\" : null;\r\n    if (!target) return;\r\n    setProcessingId(u.id);\r\n    setErr(null);\r\n    try {\r\n      const updated = await updateUserRole(u.id, target);\r\n      setUsers((s) => s.map((x) => (x.id === u.id ? updated : x)));\r\n    } catch (e: any) {\r\n      const reason =\r\n        e?.body?.message ||\r\n        e?.message ||\r\n        (typeof e === \"string\" ? e : JSON.stringify(e));\r\n      setErr(String(reason));\r\n    } finally {\r\n      setProcessingId(null);\r\n    }\r\n  }\r\n\r\n  async function removeUser(id: string) {\r\n    if (!confirm(\"Delete user? This cannot be undone.\")) return;\r\n    setProcessingId(id);\r\n    try {\r\n      await deleteUser(id);\r\n      setUsers((s) => s.filter((u) => u.id !== id));\r\n    } catch (e: any) {\r\n      const reason =\r\n        e?.body?.message ||\r\n        e?.message ||\r\n        (typeof e === \"string\" ? e : JSON.stringify(e));\r\n      setErr(String(reason));\r\n    } finally {\r\n      setProcessingId(null);\r\n    }\r\n  }\r\n\r\n  if (!hydrated) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <h2 className=\"text-2xl mb-4 text-center\">User Management</h2>\r\n        <div className=\"bg-white shadow rounded p-4\">\r\n          <div className=\"h-8 bg-gray-100 rounded mb-3 w-1/3\" />\r\n          <div className=\"space-y-2\">\r\n            <div className=\"h-12 bg-gray-100 rounded\" />\r\n            <div className=\"h-12 bg-gray-100 rounded\" />\r\n            <div className=\"h-12 bg-gray-100 rounded\" />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // now hydrated: check admin\r\n  if (!isAdmin) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <h2 className=\"text-2xl mb-4 text-center\">User Management</h2>\r\n        <div className=\"text-red-600\">Access denied.</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // actual admin UI\r\n  return (\r\n    <div className=\"p-6\">\r\n      <h2 className=\"text-3xl font-bold mb-4 text-center\">User Management</h2>\r\n\r\n      {err && <div className=\"mb-4 text-red-600 text-center font-bold\">{err}</div>}\r\n\r\n      <form\r\n        onSubmit={handleCreate}\r\n        className=\"mb-6 bg-white shadow rounded p-4\"\r\n      >\r\n        <div className=\"flex flex-col gap-3 md:flex-row md:items-center md:gap-2\">\r\n          <input\r\n            value={email}\r\n            onChange={(e) => setEmail(e.target.value)}\r\n            placeholder=\"Email\"\r\n            aria-label=\"email\"\r\n            className=\"px-3 py-2 h-10 border rounded w-full md:w-60 text-sm\"\r\n          />\r\n\r\n          <input\r\n            value={password}\r\n            onChange={(e) => setPassword(e.target.value)}\r\n            placeholder=\"Password (min 7 chars)\"\r\n            type=\"password\"\r\n            aria-label=\"password\"\r\n            className=\"px-3 py-2 h-10 border rounded w-full md:w-56 text-sm\"\r\n          />\r\n\r\n          <input\r\n            value={name}\r\n            onChange={(e) => setName(e.target.value)}\r\n            placeholder=\"Full name (optional)\"\r\n            aria-label=\"name\"\r\n            className=\"px-3 py-2 h-10 border rounded w-full md:w-56 text-sm\"\r\n          />\r\n\r\n          <div className=\"flex items-center gap-2\">\r\n            <label className=\"text-sm font-medium whitespace-nowrap\">\r\n              Role:\r\n            </label>\r\n            <select\r\n              value={role}\r\n              onChange={(e) => setRole(e.target.value as any)}\r\n              className=\"px-3 py-2 h-10 border rounded text-sm\"\r\n            >\r\n              <option value=\"member\">Member</option>\r\n              <option value=\"admin\">Admin</option>\r\n              {/* <option value=\"owner\">Owner</option> */}\r\n            </select>\r\n          </div>\r\n\r\n          {/* Create button */}\r\n          <button\r\n            type=\"submit\"\r\n            disabled={creating}\r\n            className=\"bg-indigo-600 text-white px-5 py-2 h-10 rounded shadow hover:bg-indigo-700 disabled:opacity-60 md:ml-auto\"\r\n          >\r\n            {creating ? \"Creating…\" : \"Create user\"}\r\n          </button>\r\n\r\n          {/* Reset button */}\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => {\r\n              setEmail(\"\");\r\n              setPassword(\"\");\r\n              setName(\"\");\r\n              setRole(\"member\");\r\n              setErr(null);\r\n            }}\r\n            className=\"px-5 py-2 h-10 rounded border border-gray-400 text-gray-700 hover:bg-gray-100 text-sm\"\r\n          >\r\n            Reset\r\n          </button>\r\n        </div>\r\n      </form>\r\n\r\n      <div className=\"bg-white shadow rounded p-4\">\r\n        <div className=\"flex items-center justify-between mb-3\">\r\n          <h3 className=\"text-xl font-semibold\">All users</h3>\r\n          <div className=\"text-sm text-gray-500\">{users.length} users</div>\r\n        </div>\r\n\r\n        {loading ? (\r\n          <div>Loading users…</div>\r\n        ) : (\r\n          <div className=\"max-h-[50vh] overflow-y-auto\">\r\n            <ul className=\"space-y-2\">\r\n              {users.map((u) => (\r\n                <li\r\n                  key={u.id}\r\n                  className=\"p-3 border rounded flex items-center justify-between hover:shadow-sm transition\"\r\n                >\r\n                  <div>\r\n                    <div className=\"text-lg font-medium\">\r\n                      {u.name || \"—\"}{\" \"}\r\n                      <span className=\"ml-2 text-sm text-gray-500\">\r\n                        {u.email}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"text-sm text-gray-600\">Role: {u.role}</div>\r\n                  </div>\r\n\r\n                  <div className=\"flex items-center gap-2\">\r\n                    {u.role !== \"owner\" && (\r\n                      <button\r\n                        onClick={() => changeRolePromoteDemote(u)}\r\n                        className=\"px-3 py-1 border rounded text-sm bg-emerald-50 hover:bg-emerald-100\"\r\n                        disabled={processingId === u.id}\r\n                        title={\r\n                          u.role === \"member\"\r\n                            ? \"Promote to admin\"\r\n                            : u.role === \"admin\"\r\n                            ? \"Demote to member\"\r\n                            : \"\"\r\n                        }\r\n                      >\r\n                        {processingId === u.id\r\n                          ? \"Working…\"\r\n                          : u.role === \"member\"\r\n                          ? \"Promote → admin\"\r\n                          : u.role === \"admin\"\r\n                          ? \"Demote → member\"\r\n                          : \"\"}\r\n                      </button>\r\n                    )}\r\n\r\n                    <button\r\n                      onClick={() => removeUser(u.id)}\r\n                      className=\"px-3 py-1 rounded bg-red-600 text-white text-sm\"\r\n                      disabled={processingId === u.id}\r\n                      title=\"Delete user\"\r\n                    >\r\n                      {processingId === u.id ? \"Working…\" : \"Delete\"}\r\n                    </button>\r\n                  </div>\r\n                </li>\r\n              ))}\r\n              {users.length === 0 && (\r\n                <div className=\"p-3 text-gray-600\">No other users yet.</div>\r\n              )}\r\n            </ul>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}