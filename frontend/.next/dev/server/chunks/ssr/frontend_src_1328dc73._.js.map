{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Window/Desktop/Teamflow/frontend/src/components/dnd/SortableItem.tsx"],"sourcesContent":["'use client';\r\nimport React from 'react';\r\nimport { useSortable } from '@dnd-kit/sortable';\r\nimport { CSS } from '@dnd-kit/utilities';\r\n\r\nexport default function SortableItem({\r\n  id,\r\n  title,\r\n  onOpen,\r\n  assigneeName,\r\n  status,\r\n}: {\r\n  id: string;\r\n  title: string;\r\n  onOpen?: () => void;\r\n  assigneeName?: string | null;\r\n  status?: string | null;\r\n}) {\r\n  const { attributes, listeners, setNodeRef, transform, transition } = useSortable({ id });\r\n  const style: React.CSSProperties = {\r\n    transform: CSS.Transform.toString(transform),\r\n    transition,\r\n    cursor: 'grab',\r\n  };\r\n\r\n  const statusUpper = status ? String(status).toUpperCase() : '';\r\n\r\n  // normalize assignee label — treat empty/whitespace as \"Unassigned\"\r\n  const assigneeLabel =\r\n    typeof assigneeName === 'string' && assigneeName.trim().length > 0\r\n      ? assigneeName.trim()\r\n      : 'Unassigned';\r\n\r\n  return (\r\n    <div\r\n      ref={setNodeRef}\r\n      style={style}\r\n      {...attributes}\r\n      {...listeners}\r\n      className={`p-2 rounded border ${statusUpper === 'FINISHED' ? 'bg-green-100' : 'bg-white'}`}\r\n      role=\"button\"\r\n      onClick={() => onOpen && onOpen()}\r\n    >\r\n      <div className=\"font-medium\">{title}</div>\r\n      <div className=\"text-xs text-gray-600 mt-1\">\r\n        <span>Assigned to: {assigneeLabel}</span>\r\n        <span className=\"mx-2\">•</span>\r\n        <span>Status: {statusUpper || 'TODO'}</span>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAKe,SAAS,aAAa,EACnC,EAAE,EACF,KAAK,EACL,MAAM,EACN,YAAY,EACZ,MAAM,EAOP;IACC,MAAM,EAAE,UAAU,EAAE,SAAS,EAAE,UAAU,EAAE,SAAS,EAAE,UAAU,EAAE,GAAG,IAAA,8LAAW,EAAC;QAAE;IAAG;IACtF,MAAM,QAA6B;QACjC,WAAW,wLAAG,CAAC,SAAS,CAAC,QAAQ,CAAC;QAClC;QACA,QAAQ;IACV;IAEA,MAAM,cAAc,SAAS,OAAO,QAAQ,WAAW,KAAK;IAE5D,oEAAoE;IACpE,MAAM,gBACJ,OAAO,iBAAiB,YAAY,aAAa,IAAI,GAAG,MAAM,GAAG,IAC7D,aAAa,IAAI,KACjB;IAEN,qBACE,0PAAC;QACC,KAAK;QACL,OAAO;QACN,GAAG,UAAU;QACb,GAAG,SAAS;QACb,WAAW,CAAC,mBAAmB,EAAE,gBAAgB,aAAa,iBAAiB,YAAY;QAC3F,MAAK;QACL,SAAS,IAAM,UAAU;;0BAEzB,0PAAC;gBAAI,WAAU;0BAAe;;;;;;0BAC9B,0PAAC;gBAAI,WAAU;;kCACb,0PAAC;;4BAAK;4BAAc;;;;;;;kCACpB,0PAAC;wBAAK,WAAU;kCAAO;;;;;;kCACvB,0PAAC;;4BAAK;4BAAS,eAAe;;;;;;;;;;;;;;;;;;;AAItC","debugId":null}},
    {"offset": {"line": 92, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Window/Desktop/Teamflow/frontend/src/components/TaskBoard.tsx"],"sourcesContent":["\"use client\";\r\n// frontend/src/components/TaskBoard.tsx\r\nimport React, { useState } from \"react\";\r\nimport {\r\n  DndContext,\r\n  DragEndEvent,\r\n  PointerSensor,\r\n  useSensor,\r\n  useSensors,\r\n  closestCenter,\r\n  DragStartEvent,\r\n  useDroppable,\r\n} from \"@dnd-kit/core\";\r\nimport {\r\n  arrayMove,\r\n  SortableContext,\r\n  verticalListSortingStrategy,\r\n} from \"@dnd-kit/sortable\";\r\nimport SortableItem from \"./dnd/SortableItem\";\r\n\r\nexport type Task = {\r\n  id: string;\r\n  title: string;\r\n  position?: number;\r\n  description?: string;\r\n  assigneeId?: string | null;\r\n  assigneeName?: string | null;\r\n  status?: string | null; // server may return lowercase/uppercase\r\n};\r\nexport type Column = {\r\n  id: string;\r\n  title: string;\r\n  position?: number;\r\n  tasks: Task[];\r\n};\r\n\r\ntype Props = {\r\n  columns: Column[]; // controlled source of truth\r\n  onMove: (\r\n    taskId: string,\r\n    targetColumnId: string,\r\n    targetPosition: number\r\n  ) => Promise<void>;\r\n  onColumnsChange?: (cols: Column[]) => void; // called for optimistic updates & rollbacks\r\n  onAddTask?: (columnId: string, title: string) => Promise<void>;\r\n  onOpenTask?: (taskId: string) => void;\r\n  onDeleteColumn?: (columnId: string) => Promise<void>;\r\n  isManager?: boolean;\r\n};\r\n\r\nfunction EmptyDropPad({ colId }: { colId: string }) {\r\n  const dropId = `empty-${colId}`;\r\n  const { setNodeRef, isOver } = useDroppable({ id: dropId });\r\n  return (\r\n    <div\r\n      ref={setNodeRef}\r\n      data-empty-pad\r\n      style={{\r\n        minHeight: 48,\r\n        borderRadius: 6,\r\n        display: \"flex\",\r\n        alignItems: \"center\",\r\n        justifyContent: \"center\",\r\n        opacity: isOver ? 0.7 : 0.08,\r\n      }}\r\n      className=\"bg-white/10\"\r\n    >\r\n      {isOver ? \"Release to drop\" : \"\"}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function TaskBoard({\r\n  columns = [],\r\n  onMove,\r\n  onColumnsChange,\r\n  onAddTask,\r\n  onOpenTask,\r\n  onDeleteColumn,\r\n  isManager = false,\r\n}: Props) {\r\n  const sensors = useSensors(\r\n    useSensor(PointerSensor, { activationConstraint: { distance: 5 } })\r\n  );\r\n  const [newTaskTitles, setNewTaskTitles] = useState<Record<string, string>>(\r\n    {}\r\n  );\r\n\r\n  function findColumnByContainedId(id: string) {\r\n    if (id.startsWith(\"empty-\")) {\r\n      const cid = id.slice(\"empty-\".length);\r\n      const byCol = columns.find((c) => c.id === cid);\r\n      if (byCol)\r\n        return { column: byCol, matchedBy: \"empty-pad\" as const, rawId: id };\r\n    }\r\n\r\n    const byTask = columns.find((c) =>\r\n      (c.tasks || []).some((t) => t.id === id)\r\n    );\r\n    if (byTask)\r\n      return { column: byTask, matchedBy: \"task\" as const, rawId: id };\r\n\r\n    const byCol = columns.find((c) => c.id === id);\r\n    if (byCol)\r\n      return { column: byCol, matchedBy: \"column\" as const, rawId: id };\r\n\r\n    return null;\r\n  }\r\n\r\n  async function handleDragEnd(event: DragEndEvent) {\r\n    const { active, over } = event;\r\n    if (!over) return;\r\n\r\n    const activeId = String(active.id);\r\n    const overId = String(over.id);\r\n    if (activeId === overId) return;\r\n\r\n    const sourceInfo = findColumnByContainedId(activeId);\r\n    const destInfo = findColumnByContainedId(overId);\r\n    if (!sourceInfo || !destInfo) return;\r\n\r\n    const sourceCol = sourceInfo.column;\r\n    const destCol = destInfo.column;\r\n\r\n    const prevCols = columns.map((c) => ({\r\n      ...c,\r\n      tasks: [...(c.tasks || [])],\r\n    }));\r\n\r\n    // same-column reorder\r\n    if (\r\n      sourceCol.id === destCol.id &&\r\n      sourceInfo.matchedBy === \"task\" &&\r\n      destInfo.matchedBy === \"task\"\r\n    ) {\r\n      const sourceIndex = sourceCol.tasks.findIndex((t) => t.id === activeId);\r\n      const destIndex = destCol.tasks.findIndex((t) => t.id === overId);\r\n      if (sourceIndex === -1 || destIndex === -1) return;\r\n\r\n      const newTasks = arrayMove([...sourceCol.tasks], sourceIndex, destIndex);\r\n      const newCols = columns.map((c) =>\r\n        c.id === sourceCol.id ? { ...c, tasks: newTasks } : c\r\n      );\r\n      onColumnsChange?.(newCols);\r\n      try {\r\n        await onMove(activeId, destCol.id, destIndex);\r\n      } catch {\r\n        onColumnsChange?.(prevCols);\r\n      }\r\n      return;\r\n    }\r\n\r\n    // cross-column move\r\n    const srcTasks = [...(sourceCol.tasks || [])];\r\n    const dstTasks = [...(destCol.tasks || [])];\r\n\r\n    const sourceIndex = srcTasks.findIndex((t) => t.id === activeId);\r\n    if (sourceIndex === -1) return;\r\n\r\n    let destIndex = dstTasks.findIndex((t) => t.id === overId);\r\n    if (destIndex === -1) {\r\n      destIndex = dstTasks.length;\r\n    }\r\n\r\n    const [moved] = srcTasks.splice(sourceIndex, 1);\r\n    dstTasks.splice(destIndex, 0, moved);\r\n\r\n    const newCols = columns.map((c) => {\r\n      if (c.id === sourceCol.id) return { ...c, tasks: srcTasks };\r\n      if (c.id === destCol.id) return { ...c, tasks: dstTasks };\r\n      return c;\r\n    });\r\n\r\n    onColumnsChange?.(newCols);\r\n\r\n    try {\r\n      await onMove(activeId, destCol.id, destIndex);\r\n    } catch {\r\n      onColumnsChange?.(prevCols);\r\n    }\r\n  }\r\n\r\n  function handleDragStart(_e: DragStartEvent) {}\r\n\r\n  async function handleAddTask(columnId: string) {\r\n    const title = (newTaskTitles[columnId] || \"\").trim();\r\n    if (!title) return;\r\n    setNewTaskTitles((s) => ({ ...s, [columnId]: \"\" }));\r\n    if (onAddTask) {\r\n      try {\r\n        await onAddTask(columnId, title);\r\n      } catch (err) {\r\n        setNewTaskTitles((s) => ({ ...s, [columnId]: title }));\r\n      }\r\n    }\r\n  }\r\n\r\n  async function handleDeleteColumn(column: Column) {\r\n    if ((column.tasks || []).length > 0) {\r\n      alert(\"Cannot delete a column that contains tasks. Remove tasks first.\");\r\n      return;\r\n    }\r\n    if (!confirm(`Delete column \"${column.title}\"? This cannot be undone.`))\r\n      return;\r\n    if (!onDeleteColumn) return;\r\n    try {\r\n      await onDeleteColumn(column.id);\r\n    } catch (err) {\r\n      console.error(\"delete column failed\", err);\r\n      alert(\"Failed to delete column\");\r\n    }\r\n  }\r\n\r\n  // helper: normalize status string\r\n  const statusOf = (t: Task) =>\r\n    t.status ? String(t.status).toUpperCase() : \"\";\r\n\r\n  return (\r\n    <DndContext\r\n      sensors={sensors}\r\n      collisionDetection={closestCenter}\r\n      onDragEnd={handleDragEnd}\r\n      onDragStart={handleDragStart}\r\n    >\r\n      <div className=\"w-full overflow-x-auto\">\r\n        <div className=\"flex gap-4 px-2\" style={{ minHeight: \"60vh\" }}>\r\n          {columns.map((col) => {\r\n            const inProgressCount = (col.tasks || []).filter(\r\n              (t) => statusOf(t) === \"IN_PROGRESS\"\r\n            ).length;\r\n            const doneCount = (col.tasks || []).filter(\r\n              (t) => statusOf(t) === \"FINISHED\"\r\n            ).length;\r\n\r\n            return (\r\n              <div\r\n                key={col.id}\r\n                className=\"shrink-0 bg-gray-100 rounded overflow-hidden\"\r\n                style={{\r\n                  width: 320,\r\n                  display: \"flex\",\r\n                  flexDirection: \"column\",\r\n                  height: \"70vh\",\r\n                }}\r\n              >\r\n                {/* header */}\r\n                <div\r\n                  className=\"px-3 py-2 border-b bg-white flex items-center justify-between\"\r\n                  style={{ flexShrink: 0 }}\r\n                >\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <div className=\"font-semibold text-sm truncate\">\r\n                      {col.title}\r\n                    </div>\r\n                    <div className=\"text-xs text-gray-600\">\r\n                      <span className=\"mr-2\">In-Progress: {inProgressCount}</span>\r\n                      <span>Done: {doneCount}</span>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {isManager ? (\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <button\r\n                        onClick={() => handleDeleteColumn(col)}\r\n                        className=\"text-sm text-red-600 px-2 py-1 border rounded\"\r\n                        title=\"Delete column (only if empty)\"\r\n                      >\r\n                        Delete\r\n                      </button>\r\n                    </div>\r\n                  ) : null}\r\n                </div>\r\n\r\n                {/* body */}\r\n                <div className=\"p-3 overflow-y-auto\" style={{ flex: 1 }}>\r\n                  <SortableContext\r\n                    items={(col.tasks || []).map((t) => t.id)}\r\n                    strategy={verticalListSortingStrategy}\r\n                  >\r\n                    <div className=\"space-y-2\">\r\n                      {(col.tasks || []).length > 0 ? (\r\n                        (col.tasks || []).map((t) => (\r\n                          <SortableItem\r\n                            key={t.id}\r\n                            id={t.id}\r\n                            title={t.title}\r\n                            assigneeName={t.assigneeName}\r\n                            status={t.status}\r\n                            onOpen={() => onOpenTask?.(t.id)}\r\n                          />\r\n                        ))\r\n                      ) : (\r\n                        <EmptyDropPad colId={col.id} />\r\n                      )}\r\n                    </div>\r\n                  </SortableContext>\r\n                </div>\r\n\r\n                {/* footer */}\r\n                <div\r\n                  className=\"p-3 border-t bg-white\"\r\n                  style={{ flexShrink: 0 }}\r\n                >\r\n                  <div className=\"flex gap-2\">\r\n                    <input\r\n                      value={newTaskTitles[col.id] || \"\"}\r\n                      onChange={(e) =>\r\n                        setNewTaskTitles((prev) => ({\r\n                          ...prev,\r\n                          [col.id]: e.target.value,\r\n                        }))\r\n                      }\r\n                      placeholder={`New task in ${col.title}`}\r\n                      className=\"flex-1 px-2 py-1 border rounded\"\r\n                    />\r\n                    <button\r\n                      onClick={() => handleAddTask(col.id)}\r\n                      className=\"px-3 py-1 bg-green-600 text-white rounded\"\r\n                    >\r\n                      Add\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n    </DndContext>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 478, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Window/Desktop/Teamflow/frontend/src/components/TaskModal.tsx"],"sourcesContent":["\"use client\";\r\n// frontend/src/components/TaskModal.tsx\r\nimport React, { useEffect, useState } from \"react\";\r\n\r\ntype Task = {\r\n  id: string;\r\n  title?: string | null;\r\n  description?: string | null;\r\n  assigneeId?: string | null;\r\n  status?: \"TODO\" | \"IN_PROGRESS\" | \"FINISHED\" | null;\r\n};\r\n\r\ntype TeamMember = {\r\n  id: string;\r\n  role?: string;\r\n  user?: { id: string; name?: string | null; email?: string | null };\r\n  busyElsewhere?: boolean;\r\n};\r\n\r\ntype Props = {\r\n  task: Task | null;\r\n  projectId?: string | null;\r\n  teamMembers?: TeamMember[];\r\n  assignedUserIds?: string[];\r\n  onClose: () => void;\r\n  onSave: (updates: {\r\n    title?: string;\r\n    description?: string;\r\n    assigneeId?: string | null;\r\n    status?: Task[\"status\"];\r\n  }) => Promise<any>;\r\n  onDelete: () => Promise<void>;\r\n};\r\n\r\nexport default function TaskModal({\r\n  task,\r\n  teamMembers = [],\r\n  assignedUserIds = [],\r\n  onClose,\r\n  onSave,\r\n  onDelete,\r\n}: Props) {\r\n  const [title, setTitle] = useState(\"\");\r\n  const [description, setDescription] = useState(\"\");\r\n  const [assigneeId, setAssigneeId] = useState<string | null>(null);\r\n  const [status, setStatus] = useState<Task[\"status\"]>(\"TODO\");\r\n  const [saving, setSaving] = useState(false);\r\n  const [deleting, setDeleting] = useState(false);\r\n  const [err, setErr] = useState<string | null>(null);\r\n\r\n  // initialize local editable state when task changes\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  useEffect(() => {\r\n    if (!task) return;\r\n    setTitle(task.title ?? \"\");\r\n    setDescription(task.description ?? \"\");\r\n    setAssigneeId(task.assigneeId ?? null);\r\n    setStatus((task.status as Task[\"status\"]) ?? \"TODO\");\r\n    setErr(null);\r\n  }, [task]);\r\n\r\n  if (!task) return null;\r\n\r\n  // Build options: filter out members who already have a task in this same project,\r\n  // except allow current assignee to remain selectable.\r\n  const options = (teamMembers || [])\r\n    .map((m) => {\r\n      const user = m.user ?? { id: m.id, name: undefined, email: undefined };\r\n      return { member: m, user };\r\n    })\r\n    .filter(({ user, member }) => {\r\n      const isAssignedInThisProject = (assignedUserIds || []).includes(user.id);\r\n      const isCurrentAssignee = task.assigneeId === user.id;\r\n      if (isAssignedInThisProject && !isCurrentAssignee) return false;\r\n      return true;\r\n    });\r\n\r\n  async function save() {\r\n    setErr(null);\r\n    setSaving(true);\r\n    try {\r\n      const payload = {\r\n        title: title.trim() || undefined,\r\n        description: description.trim() || undefined,\r\n        assigneeId: assigneeId || null,\r\n        status,\r\n      };\r\n      const result = await onSave(payload);\r\n      setSaving(false);\r\n      onClose();\r\n      return result;\r\n    } catch (e: any) {\r\n      setSaving(false);\r\n      const msg = e?.body?.message ?? e?.message ?? \"Save failed\";\r\n      setErr(msg);\r\n      throw e;\r\n    }\r\n  }\r\n\r\n  async function remove() {\r\n    if (!confirm(\"Delete this task? This cannot be undone.\")) return;\r\n    setDeleting(true);\r\n    try {\r\n      await onDelete();\r\n      setDeleting(false);\r\n      onClose();\r\n    } catch (e: any) {\r\n      setDeleting(false);\r\n      const msg = e?.body?.message ?? e?.message ?? \"Delete failed\";\r\n      setErr(msg);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\r\n      <div className=\"absolute inset-0 bg-black/40\" onClick={onClose} />\r\n      <div className=\"relative w-full max-w-2xl bg-white rounded shadow-lg p-6 z-10\">\r\n        <h3 className=\"text-lg font-semibold mb-3\">Edit task</h3>\r\n\r\n        {err && <div className=\"mb-3 text-sm text-red-600\">{err}</div>}\r\n\r\n        <label className=\"block mb-2 text-sm\">Title</label>\r\n        <input\r\n          value={title}\r\n          onChange={(e) => setTitle(e.target.value)}\r\n          className=\"w-full px-3 py-2 border rounded mb-3\"\r\n        />\r\n\r\n        <label className=\"block mb-2 text-sm\">Description</label>\r\n        <textarea\r\n          value={description}\r\n          onChange={(e) => setDescription(e.target.value)}\r\n          className=\"w-full px-3 py-2 border rounded mb-3\"\r\n          rows={5}\r\n        />\r\n\r\n        <label className=\"block mb-2 text-sm\">Status</label>\r\n        <select\r\n          value={status ?? \"TODO\"}\r\n          onChange={(e) => setStatus(e.target.value as Task[\"status\"])}\r\n          className=\"w-full px-3 py-2 border rounded mb-3\"\r\n        >\r\n          <option value=\"TODO\">TODO</option>\r\n          <option value=\"IN_PROGRESS\">IN_PROGRESS</option>\r\n          <option value=\"FINISHED\">FINISHED</option>\r\n        </select>\r\n\r\n        <label className=\"block mb-2 text-sm\">Assignee</label>\r\n        <select\r\n          value={assigneeId ?? \"\"}\r\n          onChange={(e) => setAssigneeId(e.target.value || null)}\r\n          className=\"w-full px-3 py-2 border rounded mb-4\"\r\n        >\r\n          <option value=\"\">Unassigned</option>\r\n          {options.map(({ user, member }) => {\r\n            const busyElsewhere = !!member.busyElsewhere;\r\n            const label = `${user.name ?? user.email ?? user.id}${\r\n              busyElsewhere ? \" (busy elsewhere)\" : \"\"\r\n            }`;\r\n            return (\r\n              <option\r\n                key={user.id}\r\n                value={user.id}\r\n                style={busyElsewhere ? { backgroundColor: \"#ffecec\" } : undefined}\r\n              >\r\n                {label}\r\n              </option>\r\n            );\r\n          })}\r\n        </select>\r\n\r\n        <div className=\"flex justify-between\">\r\n          <div className=\"flex gap-2\">\r\n            <button\r\n              onClick={save}\r\n              className=\"bg-indigo-600 text-white px-4 py-2 rounded\"\r\n              disabled={saving}\r\n            >\r\n              {saving ? \"Saving...\" : \"Save\"}\r\n            </button>\r\n            <button\r\n              onClick={onClose}\r\n              className=\"px-4 py-2 rounded border\"\r\n              disabled={saving || deleting}\r\n            >\r\n              Cancel\r\n            </button>\r\n          </div>\r\n\r\n          <div>\r\n            <button\r\n              onClick={remove}\r\n              className=\"px-3 py-2 rounded bg-red-600 text-white\"\r\n              disabled={deleting}\r\n            >\r\n              {deleting ? \"Deleting...\" : \"Delete\"}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 782, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Window/Desktop/Teamflow/frontend/src/app/projects/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\";\r\n// frontend/src/app/projects/[id]/page.tsx\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useParams } from \"next/navigation\";\r\nimport {\r\n  getProject,\r\n  createColumn,\r\n  createTask,\r\n  moveTask,\r\n  updateTask,\r\n  deleteTask,\r\n  getTeamMembers,\r\n  deleteColumn,\r\n} from \"../../../lib/api\";\r\nimport TaskBoard, { Column } from \"../../../components/TaskBoard\";\r\nimport TaskModal from \"../../../components/TaskModal\";\r\nimport { useAuth } from \"../../../context/AuthContext\"; // adjust path if different\r\n\r\ntype TaskShape = {\r\n  id: string;\r\n  title?: string;\r\n  description?: string | null;\r\n  assigneeId?: string | null;\r\n  status?: \"TODO\" | \"IN_PROGRESS\" | \"FINISHED\" | null;\r\n};\r\n\r\nexport default function ProjectBoard() {\r\n  const params = useParams();\r\n  const projectId = params.id;\r\n  const { user } = useAuth(); // expects { id, role } in auth context; if your useAuth differs, adapt\r\n  const [project, setProject] = useState<any | null>(null);\r\n  const [teamMembers, setTeamMembers] = useState<any[]>([]);\r\n  const [msg, setMsg] = useState<string | null>(null);\r\n  const [newColTitle, setNewColTitle] = useState(\"\");\r\n  const [openTask, setOpenTask] = useState<any | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!projectId) return;\r\n    let cancelled = false;\r\n    (async () => {\r\n      try {\r\n        const p = await getProject(projectId);\r\n        const normalized = {\r\n          ...p,\r\n          columns: (p?.columns || []).map((c: any) => ({\r\n            ...c,\r\n            tasks: c?.tasks || [],\r\n          })),\r\n        };\r\n        if (cancelled) return;\r\n        setProject(normalized);\r\n\r\n        if (normalized.teamId) {\r\n          try {\r\n            const members = await getTeamMembers(normalized.teamId);\r\n            if (!cancelled) setTeamMembers(members || []);\r\n          } catch {\r\n            if (!cancelled) setTeamMembers([]);\r\n          }\r\n        } else {\r\n          setTeamMembers([]);\r\n        }\r\n      } catch (err) {\r\n        if (!cancelled) setMsg(\"Failed to load project\");\r\n      }\r\n    })();\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [projectId]);\r\n\r\n  async function addColumn(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    setMsg(null);\r\n    const title = (newColTitle || \"\").trim();\r\n    if (!title) {\r\n      setMsg(\"Column title required\");\r\n      return;\r\n    }\r\n    try {\r\n      const col = await createColumn(project.id, title);\r\n      const newCol = { ...col, tasks: col?.tasks || [] };\r\n      setProject((prev) => ({\r\n        ...(prev || {}),\r\n        columns: (prev?.columns || []).concat(newCol),\r\n      }));\r\n      setNewColTitle(\"\");\r\n    } catch (err: any) {\r\n      setMsg(err?.body?.message || \"Failed to create column\");\r\n    }\r\n  }\r\n\r\n  function handleColumnsChange(cols: Column[]) {\r\n    setProject((prev) => ({ ...(prev || {}), columns: cols }));\r\n  }\r\n\r\n  async function handleMove(\r\n    taskId: string,\r\n    targetColumnId: string,\r\n    targetPosition: number\r\n  ) {\r\n    try {\r\n      await moveTask(taskId, targetColumnId, targetPosition);\r\n    } catch (err: any) {\r\n      setMsg(err?.body?.message || \"Failed to move task\");\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  async function handleAddTask(columnId: string, title: string) {\r\n    setMsg(null);\r\n    try {\r\n      const t = await createTask(columnId, title);\r\n      setProject((prev) => ({\r\n        ...(prev || {}),\r\n        columns: (prev?.columns || []).map((c: any) =>\r\n          c.id === columnId ? { ...c, tasks: [...(c.tasks || []), t] } : c\r\n        ),\r\n      }));\r\n    } catch (err: any) {\r\n      setMsg(err?.body?.message || \"Failed to create task\");\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  function handleOpenTask(taskId: string) {\r\n    if (!project) return;\r\n    for (const col of project.columns || []) {\r\n      const t = (col.tasks || []).find((x: TaskShape) => x.id === taskId);\r\n      if (t) {\r\n        setOpenTask({ ...t, columnId: col.id });\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  async function handleSaveTask(updates: {\r\n    title?: string;\r\n    description?: string;\r\n    assigneeId?: string | null;\r\n    status?: TaskShape[\"status\"];\r\n  }) {\r\n    if (!openTask) throw new Error(\"no task open\");\r\n    setMsg(null);\r\n    const taskId = openTask.id;\r\n    try {\r\n      const updated = await updateTask(taskId, updates);\r\n      setProject((prev) => {\r\n        const cols = (prev?.columns || []).map((c: any) => ({\r\n          ...c,\r\n          tasks: (c.tasks || []).map((t: any) =>\r\n            t.id === taskId ? { ...t, ...updated } : t\r\n          ),\r\n        }));\r\n        return { ...(prev || {}), columns: cols };\r\n      });\r\n\r\n      // refresh team members (to update any busy flags)\r\n      if (project?.teamId) {\r\n        try {\r\n          const members = await getTeamMembers(project.teamId);\r\n          setTeamMembers(members || []);\r\n        } catch {\r\n          // ignore\r\n        }\r\n      }\r\n\r\n      setOpenTask((prev: any) => ({ ...(prev || {}), ...updated }));\r\n      return updated;\r\n    } catch (err: any) {\r\n      setMsg(err?.body?.message || \"Failed to save task\");\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  async function handleDeleteTask() {\r\n    if (!openTask) throw new Error(\"no task open\");\r\n    const taskId = openTask.id;\r\n    try {\r\n      await deleteTask(taskId);\r\n      setProject((prev) => {\r\n        const cols = (prev?.columns || []).map((c: any) => ({\r\n          ...c,\r\n          tasks: (c.tasks || []).filter((t: any) => t.id !== taskId),\r\n        }));\r\n        return { ...(prev || {}), columns: cols };\r\n      });\r\n      setOpenTask(null);\r\n    } catch (err: any) {\r\n      setMsg(err?.body?.message || \"Failed to delete task\");\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  // delete column handler\r\n  async function handleDeleteColumn(columnId: string) {\r\n    setMsg(null);\r\n    // find column and ensure empty\r\n    const col = (project?.columns || []).find((c: any) => c.id === columnId);\r\n    if (!col) {\r\n      setMsg(\"Column not found\");\r\n      return;\r\n    }\r\n    if ((col.tasks || []).length > 0) {\r\n      setMsg(\"Cannot delete column that contains tasks. Remove tasks first.\");\r\n      return;\r\n    }\r\n    if (!confirm(\"Delete this column?\")) return;\r\n    try {\r\n      await deleteColumn(columnId);\r\n      setProject((prev) => {\r\n        return {\r\n          ...(prev || {}),\r\n          columns: (prev?.columns || []).filter((c: any) => c.id !== columnId),\r\n        };\r\n      });\r\n    } catch (err: any) {\r\n      setMsg(err?.body?.message || \"Failed to delete column\");\r\n    }\r\n  }\r\n\r\n  function computeAssignedUserIds() {\r\n    if (!project) return [];\r\n    const ids: string[] = [];\r\n    for (const c of project.columns || []) {\r\n      for (const t of c.tasks || []) {\r\n        if (t.assigneeId) ids.push(t.assigneeId);\r\n      }\r\n    }\r\n    return [...new Set(ids)];\r\n  }\r\n\r\n  // compute isManager: global admin or team owner/admin membership\r\n  const isManager = React.useMemo(() => {\r\n    if (!user) return false;\r\n    if (user.role === \"admin\") return true;\r\n    // check teamMembers for a member entry for current user with owner/admin role\r\n    const m = (teamMembers || []).find(\r\n      (x: any) =>\r\n        (x.user?.id ?? x.id) === user.id && [\"owner\", \"admin\"].includes(x.role)\r\n    );\r\n    return !!m;\r\n  }, [user, teamMembers]);\r\n\r\n  if (!project) return <div>Loading project...</div>;\r\n\r\n  return (\r\n    <div className=\"w-full\">\r\n      <h2 className=\"text-2xl font-bold mb-4\">{project.name}</h2>\r\n      {msg && <div className=\"mb-3 text-red-600\">{msg}</div>}\r\n\r\n      <div className=\"mb-4\">\r\n        <form onSubmit={addColumn} className=\"flex gap-2\">\r\n          <input\r\n            value={newColTitle}\r\n            onChange={(e) => setNewColTitle(e.target.value)}\r\n            placeholder=\"New column title\"\r\n            className=\"px-3 py-2 border rounded flex-1\"\r\n          />\r\n          <button className=\"bg-slate-600 text-white px-3 py-2 rounded\">\r\n            Add column\r\n          </button>\r\n        </form>\r\n      </div>\r\n\r\n      <TaskBoard\r\n        columns={project.columns as Column[]}\r\n        onMove={handleMove}\r\n        onColumnsChange={handleColumnsChange}\r\n        onAddTask={handleAddTask}\r\n        onOpenTask={handleOpenTask}\r\n        onDeleteColumn={handleDeleteColumn}\r\n        isManager={isManager}\r\n      />\r\n\r\n      <TaskModal\r\n        task={openTask}\r\n        projectId={project.id}\r\n        teamMembers={teamMembers || []}\r\n        assignedUserIds={computeAssignedUserIds()}\r\n        onClose={() => setOpenTask(null)}\r\n        onSave={handleSaveTask}\r\n        onDelete={handleDeleteTask}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}