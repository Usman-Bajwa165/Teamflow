{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Window/Desktop/Teamflow/frontend/src/app/projects/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\";\r\n// frontend/src/app/projects/[id]/page.tsx\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useParams } from \"next/navigation\";\r\nimport {\r\n  getProject,\r\n  createColumn,\r\n  createTask,\r\n  moveTask,\r\n} from \"../../../lib/api\";\r\nimport TaskBoard, { Column } from \"../../../src/components/TaskBoard\";\r\n\r\nexport default function ProjectBoard() {\r\n  const params = useParams();\r\n  const projectId = params.id;\r\n  const [project, setProject] = useState<any>(null);\r\n  const [newColTitle, setNewColTitle] = useState(\"\");\r\n  const [newTaskTitles, setNewTaskTitles] = useState<Record<string, string>>(\r\n    {}\r\n  );\r\n  const [msg, setMsg] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      if (!projectId) return;\r\n      try {\r\n        const p = await getProject(projectId);\r\n        const normalized = {\r\n          ...p,\r\n          columns: (p?.columns || []).map((c: any) => ({\r\n            ...c,\r\n            tasks: c?.tasks || [],\r\n          })),\r\n        };\r\n        setProject(normalized);\r\n      } catch (err) {\r\n        setMsg(\"Failed to load project\");\r\n      }\r\n    })();\r\n  }, [projectId]);\r\n\r\n  async function addColumn(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    setMsg(null);\r\n    const title = (newColTitle || \"\").trim();\r\n    if (!title) {\r\n      setMsg(\"Column title required\");\r\n      return;\r\n    }\r\n    try {\r\n      const col = await createColumn(project.id, title);\r\n      const newCol = { ...col, tasks: col?.tasks || [] };\r\n      setProject((prev) => ({\r\n        ...(prev || {}),\r\n        columns: (prev?.columns || []).concat(newCol),\r\n      }));\r\n      setNewColTitle(\"\");\r\n    } catch (err: any) {\r\n      setMsg(err?.body?.message || \"Failed to create column\");\r\n    }\r\n  }\r\n\r\n  async function addTask(columnId: string) {\r\n    setMsg(null);\r\n    const title = (newTaskTitles[columnId] || \"\").trim();\r\n    if (!title) {\r\n      setMsg(\"Task title required\");\r\n      return;\r\n    }\r\n    try {\r\n      const t = await createTask(columnId, title);\r\n      setProject((prev) => ({\r\n        ...(prev || {}),\r\n        columns: (prev?.columns || []).map((c: any) =>\r\n          c.id === columnId ? { ...c, tasks: [...(c.tasks || []), t] } : c\r\n        ),\r\n      }));\r\n      setNewTaskTitles((prev) => ({ ...prev, [columnId]: \"\" }));\r\n    } catch (err: any) {\r\n      setMsg(err?.body?.message || \"Failed to create task\");\r\n    }\r\n  }\r\n\r\n  // controlled columns-change callback used by TaskBoard for optimistic updates & rollback\r\n  function handleColumnsChange(cols: Column[]) {\r\n    setProject((prev) => ({ ...(prev || {}), columns: cols }));\r\n  }\r\n\r\n  // forwarded API call; TaskBoard manages optimistic UI via handleColumnsChange\r\n  async function handleMove(\r\n    taskId: string,\r\n    targetColumnId: string,\r\n    targetPosition: number\r\n  ) {\r\n    await moveTask(taskId, targetColumnId, targetPosition);\r\n    // optional: re-fetch canonical data here if you want to ensure server canonicality:\r\n    // const p = await getProject(projectId); setProject({...normalized p...})\r\n  }\r\n\r\n  if (!project) return <div>Loading project...</div>;\r\n\r\n  return (\r\n    <div>\r\n      <h2 className=\"text-2xl font-bold mb-4\">{project.name}</h2>\r\n      {msg && <div className=\"mb-3 text-red-600\">{msg}</div>}\r\n\r\n      <div className=\"mb-4\">\r\n        <form onSubmit={addColumn} className=\"flex gap-2\">\r\n          <input\r\n            value={newColTitle}\r\n            onChange={(e) => setNewColTitle(e.target.value)}\r\n            placeholder=\"New column title\"\r\n            className=\"px-3 py-2 border rounded flex-1\"\r\n          />\r\n          <button className=\"bg-slate-600 text-white px-3 py-2 rounded\">\r\n            Add column\r\n          </button>\r\n        </form>\r\n      </div>\r\n\r\n      <TaskBoard\r\n        columns={project.columns as Column[]}\r\n        onMove={handleMove}\r\n        onColumnsChange={handleColumnsChange}\r\n        onOpenTask={(taskId) => console.log(\"open task\", taskId)}\r\n      />\r\n\r\n      <div className=\"mt-6 grid gap-4 md:grid-cols-3\">\r\n        {(project.columns || []).map((col: any) => (\r\n          <div key={col.id} className=\"p-2\">\r\n            <input\r\n              value={newTaskTitles[col.id] || \"\"}\r\n              onChange={(e) =>\r\n                setNewTaskTitles((prev) => ({\r\n                  ...prev,\r\n                  [col.id]: e.target.value,\r\n                }))\r\n              }\r\n              placeholder={`New task in ${col.title}`}\r\n              className=\"w-full px-2 py-1 border rounded mb-2\"\r\n            />\r\n            <button\r\n              onClick={() => addTask(col.id)}\r\n              className=\"w-full bg-green-600 text-white py-1 rounded\"\r\n            >\r\n              Add task\r\n            </button>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}