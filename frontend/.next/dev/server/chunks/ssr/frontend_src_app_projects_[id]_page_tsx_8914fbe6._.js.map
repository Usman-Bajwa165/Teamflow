{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Window/Desktop/Teamflow/frontend/src/app/projects/%5Bid%5D/page.tsx"],"sourcesContent":["// frontend/src/app/projects/[id]/page.tsx\r\n\"use client\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useParams } from \"next/navigation\";\r\nimport {\r\n  getProject,\r\n  createColumn,\r\n  createTask,\r\n  moveTask,\r\n  updateTask,\r\n  deleteTask,\r\n  getTeamMembers,\r\n} from \"../../../lib/api\";\r\nimport TaskBoard, { Column } from \"../../../src/components/TaskBoard\";\r\nimport TaskModal from \"../../../src/components/TaskModal\";\r\n\r\nexport default function ProjectBoard() {\r\n  const params = useParams();\r\n  const projectId = params.id;\r\n  const [project, setProject] = useState<any>(null);\r\n  const [teamMembers, setTeamMembers] = useState<any[] | null>(null);\r\n  const [msg, setMsg] = useState<string | null>(null);\r\n  const [newColTitle, setNewColTitle] = useState(\"\");\r\n\r\n  // modal state\r\n  const [openTask, setOpenTask] = useState<any | null>(null);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      if (!projectId) return;\r\n      try {\r\n        const p = await getProject(projectId);\r\n        const normalized = {\r\n          ...p,\r\n          columns: (p?.columns || []).map((c: any) => ({\r\n            ...c,\r\n            tasks: c?.tasks || [],\r\n          })),\r\n        };\r\n        setProject(normalized);\r\n\r\n        // if project has teamId, fetch team members\r\n        if (normalized.teamId) {\r\n          try {\r\n            const members = await getTeamMembers(normalized.teamId);\r\n            setTeamMembers(members || []);\r\n          } catch (err) {\r\n            // ignore gracefully; teamMembers stays null\r\n            setTeamMembers([]);\r\n          }\r\n        } else {\r\n          setTeamMembers(null);\r\n        }\r\n      } catch (err) {\r\n        setMsg(\"Failed to load project\");\r\n      }\r\n    })();\r\n  }, [projectId]);\r\n\r\n  async function addColumn(e: React.FormEvent) {\r\n    e.preventDefault();\r\n    setMsg(null);\r\n    const title = (newColTitle || \"\").trim();\r\n    if (!title) {\r\n      setMsg(\"Column title required\");\r\n      return;\r\n    }\r\n    try {\r\n      const col = await createColumn(project.id, title);\r\n      const newCol = { ...col, tasks: col?.tasks || [] };\r\n      setProject((prev) => ({\r\n        ...(prev || {}),\r\n        columns: (prev?.columns || []).concat(newCol),\r\n      }));\r\n      setNewColTitle(\"\");\r\n    } catch (err: any) {\r\n      setMsg(err?.body?.message || \"Failed to create column\");\r\n    }\r\n  }\r\n\r\n  function handleColumnsChange(cols: Column[]) {\r\n    setProject((prev) => ({ ...(prev || {}), columns: cols }));\r\n  }\r\n\r\n  async function handleMove(\r\n    taskId: string,\r\n    targetColumnId: string,\r\n    targetPosition: number\r\n  ) {\r\n    await moveTask(taskId, targetColumnId, targetPosition);\r\n  }\r\n\r\n  async function handleAddTask(columnId: string, title: string) {\r\n    setMsg(null);\r\n    try {\r\n      const t = await createTask(columnId, title);\r\n      setProject((prev) => ({\r\n        ...(prev || {}),\r\n        columns: (prev?.columns || []).map((c: any) =>\r\n          c.id === columnId ? { ...c, tasks: [...(c.tasks || []), t] } : c\r\n        ),\r\n      }));\r\n    } catch (err: any) {\r\n      setMsg(err?.body?.message || \"Failed to create task\");\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  // open modal\r\n  function handleOpenTask(taskId: string) {\r\n    if (!project) return;\r\n    for (const col of project.columns || []) {\r\n      const t = (col.tasks || []).find((x: any) => x.id === taskId);\r\n      if (t) {\r\n        setOpenTask({ ...t, columnId: col.id });\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  // modal save handler\r\n  async function handleSaveTask(updates: {\r\n    title?: string;\r\n    description?: string;\r\n    assigneeId?: string | null;\r\n  }) {\r\n    if (!openTask) throw new Error(\"no task open\");\r\n    const taskId = openTask.id;\r\n    const updated = await updateTask(taskId, updates);\r\n    setProject((prev) => {\r\n      const cols = (prev?.columns || []).map((c: any) => ({\r\n        ...c,\r\n        tasks: (c.tasks || []).map((t: any) =>\r\n          t.id === taskId ? { ...t, ...updated } : t\r\n        ),\r\n      }));\r\n      return { ...(prev || {}), columns: cols };\r\n    });\r\n    // after change, re-calc assigned list â€” optional: we fetch members again if needed\r\n    return updated;\r\n  }\r\n\r\n  // modal delete handler\r\n  async function handleDeleteTask() {\r\n    if (!openTask) throw new Error(\"no task open\");\r\n    const taskId = openTask.id;\r\n    await deleteTask(taskId);\r\n    setProject((prev) => {\r\n      const cols = (prev?.columns || []).map((c: any) => ({\r\n        ...c,\r\n        tasks: (c.tasks || []).filter((t: any) => t.id !== taskId),\r\n      }));\r\n      return { ...(prev || {}), columns: cols };\r\n    });\r\n  }\r\n\r\n  // compute assigned user ids for this project\r\n  function computeAssignedUserIds() {\r\n    if (!project) return [];\r\n    const ids: string[] = [];\r\n    for (const c of project.columns || []) {\r\n      for (const t of c.tasks || []) {\r\n        if (t.assigneeId) ids.push(t.assigneeId);\r\n      }\r\n    }\r\n    return [...new Set(ids)];\r\n  }\r\n\r\n  if (!project) return <div>Loading project...</div>;\r\n\r\n  return (\r\n    <div>\r\n      <h2 className=\"text-2xl font-bold mb-4\">{project.name}</h2>\r\n      {msg && <div className=\"mb-3 text-red-600\">{msg}</div>}\r\n\r\n      <div className=\"mb-4\">\r\n        <form onSubmit={addColumn} className=\"flex gap-2\">\r\n          <input\r\n            value={newColTitle}\r\n            onChange={(e) => setNewColTitle(e.target.value)}\r\n            placeholder=\"New column title\"\r\n            className=\"px-3 py-2 border rounded flex-1\"\r\n          />\r\n          <button className=\"bg-slate-600 text-white px-3 py-2 rounded\">\r\n            Add column\r\n          </button>\r\n        </form>\r\n      </div>\r\n\r\n      <TaskBoard\r\n        columns={project.columns as Column[]}\r\n        onMove={handleMove}\r\n        onColumnsChange={handleColumnsChange}\r\n        onAddTask={handleAddTask}\r\n        onOpenTask={handleOpenTask}\r\n      />\r\n\r\n      <TaskModal\r\n        task={openTask}\r\n        projectId={project.id}\r\n        teamMembers={teamMembers ?? []}\r\n        assignedUserIds={computeAssignedUserIds()}\r\n        onClose={() => setOpenTask(null)}\r\n        onSave={handleSaveTask}\r\n        onDelete={handleDeleteTask}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}